<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro Fixed</title>
    <style>
        :root {
            --primary: #00f2ff;
            --secondary: #ff0055;
            --glass-bg: rgba(20, 20, 25, 0.75);
            --glass-border: rgba(255, 255, 255, 0.15);
            --text-main: #ffffff;
            --text-muted: #8b9bb4;
            
            /* 核心縮放變數 */
            --app-scale: 1.0; 
            --base-fs: calc(16px * var(--app-scale));

            /* 光影變數 */
            --sheen-x: 50%;
            --sheen-y: 50%;
            --sheen-opacity: 0;
            --sheen-color: rgba(0, 242, 255, 0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; user-select: none; -webkit-user-drag: none; }

        body {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #0f1014;
            background-image: 
                radial-gradient(circle at 50% 50%, #1a1c29 0%, #000 100%),
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 100% 100%, 40px 40px, 40px 40px;
            overflow: hidden;
            perspective: 1000px;
        }

        /* 3D Scene */
        .scene {
            position: relative;
            font-size: var(--base-fs); 
            width: 22em; height: 32em;
            transform-style: preserve-3d;
            will-change: transform;
        }

        .card-wrapper {
            position: relative;
            width: 100%; height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .card-wrapper.is-flipped { transform: rotateY(180deg); }

        /* Face Styles */
        .face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; -webkit-backface-visibility: hidden;
            background: var(--glass-bg);
            backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px);
            border: 1px solid var(--glass-border);
            border-radius: 2.5em;
            box-shadow: 0 1.5em 3em rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.05) inset;
            display: flex; flex-direction: column; align-items: center;
            padding: 2em; transform-style: preserve-3d; overflow: hidden;
        }

        /* Sheen */
        .face::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(circle at var(--sheen-x) var(--sheen-y), var(--sheen-color) 0%, transparent 60%);
            opacity: var(--sheen-opacity); z-index: 1; pointer-events: none; mix-blend-mode: overlay; transition: opacity 0.3s;
        }

        .face.front { transform: rotateY(0deg); z-index: 2; }
        .face.back { transform: rotateY(180deg); justify-content: flex-start; }

        /* Animations */
        .squash-anim { animation: jelly-squash 0.2s cubic-bezier(0.25, 1, 0.5, 1); }
        @keyframes jelly-squash {
            0% { transform: scale3d(1, 1, 1); }
            40% { transform: scale3d(1.05, 0.95, 1); }
            70% { transform: scale3d(0.95, 1.05, 1); }
            100% { transform: scale3d(1, 1, 1); }
        }

        .alarm-active svg { animation: ring-flash 0.5s infinite; }
        body.break-mode .alarm-active svg { animation: ring-flash-red 0.5s infinite; }
        @keyframes ring-flash { 0%, 100% { filter: drop-shadow(0 0 1em rgba(0,242,255,0.2)); } 50% { filter: drop-shadow(0 0 3em rgba(0,242,255,1)); } }
        @keyframes ring-flash-red { 0%, 100% { filter: drop-shadow(0 0 1em rgba(255,0,85,0.2)); } 50% { filter: drop-shadow(0 0 3em rgba(255,0,85,1)); } }

        /* Particles */
        .particle {
            position: absolute; width: 0.5em; height: 0.5em; background: var(--primary); border-radius: 50%;
            pointer-events: none; z-index: 999; box-shadow: 0 0 0.6em var(--primary);
        }
        body.break-mode .particle { background: var(--secondary); box-shadow: 0 0 0.6em var(--secondary); }

        /* UI Elements */
        .resize-handle {
            position: absolute; bottom: 0; right: 0; width: 3em; height: 3em;
            cursor: nwse-resize; z-index: 100; transform: translateZ(20px);
        }
        .resize-handle::after {
            content: ''; position: absolute; bottom: 1em; right: 1em; width: 0.8em; height: 0.8em;
            border-bottom: 0.2em solid var(--text-muted); border-right: 0.2em solid var(--text-muted); border-radius: 0.1em;
        }

        .header {
            transform: translateZ(40px); width: 100%; display: flex; justify-content: space-between; align-items: center;
            color: var(--text-muted); font-weight: 700; letter-spacing: 0.05em; font-size: 0.9em; z-index: 10;
        }
        .icon-btn { 
            background: none; border: none; color: var(--text-muted); cursor: pointer; 
            width: 2em; height: 2em; padding: 0.2em; display: flex; align-items: center; justify-content: center;
            transition: 0.2s; 
        }
        .icon-btn svg { width: 100%; height: 100%; fill: currentColor; }
        .icon-btn:hover { color: var(--text-main); transform: rotate(90deg); }

        .timer-container {
            position: relative; width: 13em; height: 13em; transform: translateZ(60px);
            display: flex; justify-content: center; align-items: center; margin: auto; cursor: pointer;
        }
        .timer-container:active { transform: translateZ(50px) scale(0.98); transition: 0.1s; }

        .timer-svg { width: 100%; height: 100%; transform: rotate(-90deg); filter: drop-shadow(0 0 1.2em rgba(0,242,255,0.2)); }
        circle { fill: none; stroke-width: 8; stroke-linecap: round; }
        .circle-bg { stroke: rgba(255,255,255,0.05); }
        .circle-progress { stroke: var(--primary); stroke-dasharray: 100 100; transition: stroke-dashoffset 0.5s linear; }

        .time-display {
            position: absolute; font-size: 3.5em; font-weight: 800; color: var(--text-main);
            text-shadow: 0 0 1em rgba(0,242,255,0.4); font-variant-numeric: tabular-nums;
        }
        
        .minus-five-hint {
            position: absolute; top: 60%; font-size: 1.5em; font-weight: bold; color: var(--secondary);
            opacity: 0; pointer-events: none; transform: translateZ(100px);
        }
        .minus-five-anim { animation: pop-up-fade 0.5s ease-out forwards; }
        @keyframes pop-up-fade {
            0% { opacity: 1; transform: translateZ(100px) translateY(0); }
            100% { opacity: 0; transform: translateZ(100px) translateY(-1.5em); }
        }

        .controls { display: flex; gap: 1em; transform: translateZ(50px); margin-bottom: 1em; z-index: 10; }
        .main-btn {
            border: none; background: rgba(255,255,255,0.05); color: var(--text-main);
            padding: 0.7em 2em; border-radius: 3em; cursor: pointer; font-weight: 700;
            transition: all 0.2s cubic-bezier(0.25, 1, 0.5, 1);
            box-shadow: 0 0.3em 1em rgba(0,0,0,0.2); backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.1);
            text-transform: uppercase; font-size: 0.85em; letter-spacing: 0.05em;
        }
        .main-btn:hover { transform: scale(1.1); background: rgba(255,255,255,0.15); box-shadow: 0 0.6em 1.5em rgba(0,0,0,0.3); }
        .main-btn:active { transform: scale(0.95); }
        .main-btn.primary { background: var(--primary); color: #000; box-shadow: 0 0 1.5em rgba(0,242,255,0.3); }
        .main-btn.primary:hover { background: #fff; box-shadow: 0 0 2.5em rgba(255,255,255,0.6); }

        /* 新增：模式切換按鈕 */
        .modes { 
            display: flex; gap: 0.5em; margin-bottom: 1.5em; 
            background: rgba(0,0,0,0.2); padding: 0.3em; border-radius: 2em;
            transform: translateZ(40px); z-index: 10;
        }
        .mode-btn {
            background: transparent; border: none; color: var(--text-muted);
            padding: 0.4em 1em; border-radius: 1.5em; cursor: pointer;
            font-size: 0.75em; font-weight: 700; transition: 0.2s;
        }
        .mode-btn.active { background: rgba(255,255,255,0.15); color: #fff; box-shadow: 0 0 1em rgba(255,255,255,0.1); }


        /* Settings UI */
        .settings-content { width: 100%; padding-top: 2em; transform: translateZ(30px); display: flex; flex-direction: column; gap: 1.5em; }
        .settings-group { width: 100%; }
        .settings-group label { display: flex; justify-content: space-between; color: var(--text-muted); margin-bottom: 0.6em; font-size: 0.9em; font-weight: 600; }
        .range-wrap { display: flex; align-items: center; gap: 1em; background: rgba(0,0,0,0.2); padding: 0.6em; border-radius: 1em; }
        input[type=range] { flex-grow: 1; -webkit-appearance: none; background: rgba(255,255,255,0.1); height: 0.3em; border-radius: 0.15em; outline: none; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 1.2em; height: 1.2em; background: var(--primary); border-radius: 50%; cursor: pointer; box-shadow: 0 0 0.6em var(--primary); transition: transform 0.2s; }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.3); }
        .range-value { color: #fff; font-weight: bold; width: 2em; text-align: right; font-size: 1em; }

        .lang-switch { display: flex; background: rgba(0,0,0,0.3); border-radius: 0.6em; padding: 0.2em; width: fit-content; margin-bottom: 2em;}
        .lang-btn { background: transparent; color: var(--text-muted); border: none; padding: 0.4em 1em; border-radius: 0.5em; cursor: pointer; font-size: 0.8em; transition: 0.2s; }
        .lang-btn.active { background: rgba(255,255,255,0.15); color: #fff; font-weight: bold; }

        .action-row { display: flex; gap: 0.6em; margin-top: auto; width: 100%; transform: translateZ(50px); }
        .action-row button { flex: 1; }

        /* Color Themes */
        body.break-mode { --primary: #ff0055; --sheen-color: rgba(255, 0, 85, 0.2); }

    </style>
</head>
<body>

    <div class="scene" id="scene">
        <div class="card-wrapper" id="cardWrapper">
            
            <div class="face front">
                <div class="resize-handle" id="resizeHandle"></div>
                <div class="header">
                    <span data-i18n="title">FOCUS MODULE</span>
                    <button class="icon-btn" id="toSettingsBtn" title="Settings">
                        <svg viewBox="0 0 24 24">
                            <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.488.488 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58a.49.49 0 0 0-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
                        </svg>
                    </button>
                </div>

                <div class="timer-container" id="timerArea">
                    <svg class="timer-svg" viewBox="0 0 220 220">
                        <circle cx="110" cy="110" r="100" class="circle-bg"></circle>
                        <path class="circle-progress" id="progressRing" d="M110,10 a100,100 0 0,1 0,200 a100,100 0 0,1 0,-200" pathLength="100" />
                    </svg>
                    <div class="time-display" id="timeDisplay">25:00</div>
                    <div class="minus-five-hint" id="minusAnim">-5s</div>
                </div>

                <div class="controls">
                    <button class="main-btn primary" id="startBtn" data-i18n="start">START</button>
                    <button class="main-btn" id="resetBtn" data-i18n="reset">RESET</button>
                </div>

                <div class="modes">
                    <button class="mode-btn active" data-mode="focus" data-i18n="workMode">WORK</button>
                    <button class="mode-btn" data-mode="break" data-i18n="breakMode">BREAK</button>
                </div>
            </div>

            <div class="face back">
                <div class="header">
                    <span data-i18n="settings">SYSTEM CONFIG</span>
                </div>
                
                <div class="settings-content">
                    <div class="lang-switch">
                        <button class="lang-btn active" data-lang="en">EN</button>
                        <button class="lang-btn" data-lang="zh">繁中</button>
                    </div>

                    <div class="settings-group">
                        <label><span data-i18n="focusTime">Focus Duration</span> <span id="focusValDisplay">25</span></label>
                        <div class="range-wrap">
                            <input type="range" id="focusInput" min="1" max="90" value="25">
                        </div>
                    </div>

                    <div class="settings-group">
                        <label><span data-i18n="breakTime">Break Duration</span> <span id="breakValDisplay">5</span></label>
                        <div class="range-wrap">
                            <input type="range" id="breakInput" min="1" max="30" value="5">
                        </div>
                    </div>
                </div>

                <div class="action-row">
                    <button class="main-btn" id="cancelSettingsBtn" data-i18n="back">BACK</button>
                    <button class="main-btn primary" id="saveSettingsBtn" data-i18n="confirm">CONFIRM</button>
                </div>
            </div>

        </div>
    </div>

    <script>
        const TRANSLATIONS = {
            en: {
                title: "FOCUS MODULE", settings: "SYSTEM CONFIG", start: "START", pause: "PAUSE", resume: "RESUME", reset: "RESET",
                focusTime: "Focus Duration (min)", breakTime: "Break Duration (min)", back: "BACK", confirm: "CONFIRM",
                sessionDone: "Focus Session Complete!", breakDone: "Break Time Over!", workMode: "WORK", breakMode: "BREAK"
            },
            zh: {
                title: "專注模式", settings: "系統設定", start: "開始", pause: "暫停", resume: "繼續", reset: "重置",
                focusTime: "專注時長 (分)", breakTime: "休息時長 (分)", back: "返回", confirm: "確認",
                sessionDone: "專注結束！休息一下。", breakDone: "休息結束！回到工作。", workMode: "工作", breakMode: "休息"
            }
        };

        class Spring {
            constructor(stiffness = 0.05, damping = 0.85) {
                this.target = 0; this.current = 0; this.velocity = 0;
                this.stiffness = stiffness; this.damping = damping;
            }
            update() {
                const force = (this.target - this.current) * this.stiffness;
                this.velocity += force; this.velocity *= this.damping;
                this.current += this.velocity;
            }
            impulse(amount) { this.velocity += amount; }
        }

        class PomodoroApp {
            constructor() {
                this.lang = 'en';
                this.settings = { focus: 25, break: 5 };
                this.state = {
                    timeLeft: 25 * 60, initialTime: 25 * 60,
                    isRunning: false, mode: 'focus', timerId: null, appScale: 1.0
                };
                this.physics = {
                    rotateX: new Spring(0.04, 0.85),
                    rotateY: new Spring(0.04, 0.85),
                    scale: new Spring(0.1, 0.75),
                };
                this.physics.scale.current = 1.0; this.physics.scale.target = 1.0;

                this.dom = this.cacheDOM();
                this.init();
            }

            cacheDOM() {
                return {
                    scene: document.getElementById('scene'),
                    cardWrapper: document.getElementById('cardWrapper'),
                    timerArea: document.getElementById('timerArea'),
                    display: document.getElementById('timeDisplay'),
                    ring: document.getElementById('progressRing'),
                    minusHint: document.getElementById('minusAnim'),
                    startBtn: document.getElementById('startBtn'),
                    resetBtn: document.getElementById('resetBtn'),
                    toSettingsBtn: document.getElementById('toSettingsBtn'),
                    saveBtn: document.getElementById('saveSettingsBtn'),
                    cancelBtn: document.getElementById('cancelSettingsBtn'),
                    focusInput: document.getElementById('focusInput'),
                    breakInput: document.getElementById('breakInput'),
                    focusVal: document.getElementById('focusValDisplay'),
                    breakVal: document.getElementById('breakValDisplay'),
                    langBtns: document.querySelectorAll('.lang-btn'),
                    resizeHandle: document.getElementById('resizeHandle'),
                    i18nElements: document.querySelectorAll('[data-i18n]'),
                    // 新增 Mode Buttons 綁定
                    modeBtns: document.querySelectorAll('.mode-btn'),
                    body: document.body
                };
            }

            init() {
                this.initListeners();
                this.loopPhysics();
                this.updateDisplay();
                this.updateText();
            }

            loopPhysics() {
                this.physics.rotateX.update();
                this.physics.rotateY.update();
                this.physics.scale.update();
                const s = this.physics.scale.current;
                const rX = this.physics.rotateX.current;
                const rY = this.physics.rotateY.current;
                this.dom.scene.style.transform = `scale(${s}) rotateX(${rX}deg) rotateY(${rY}deg)`;
                
                const sheenX = 50 + (rY * 2); 
                const sheenY = 50 - (rX * 2);
                document.body.style.setProperty('--sheen-x', `${sheenX}%`);
                document.body.style.setProperty('--sheen-y', `${sheenY}%`);
                document.body.style.setProperty('--sheen-opacity', Math.min(1, (Math.abs(rX) + Math.abs(rY)) / 20 + 0.1));
                
                requestAnimationFrame(() => this.loopPhysics());
            }

            initListeners() {
                document.addEventListener('mousemove', (e) => {
                    if (this.isResizing) return;
                    const w = window.innerWidth; const h = window.innerHeight;
                    this.physics.rotateY.target = (e.clientX - w / 2) / (w / 30);
                    this.physics.rotateX.target = -(e.clientY - h / 2) / (h / 30);
                });
                document.addEventListener('mouseleave', () => {
                    this.physics.rotateY.target = 0; this.physics.rotateX.target = 0;
                });
                
                this.dom.timerArea.addEventListener('dblclick', (e) => {
                    e.preventDefault();
                    this.subtractTime();
                    this.physics.scale.impulse(-0.1);
                    this.physics.rotateX.impulse(5);
                });

                this.dom.startBtn.addEventListener('click', () => { this.physics.scale.impulse(-0.05); this.toggleTimer(); });
                this.dom.resetBtn.addEventListener('click', () => { this.physics.scale.impulse(-0.05); this.reset(); });
                
                // 模式按鈕監聽
                this.dom.modeBtns.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.physics.scale.impulse(-0.05);
                        this.switchMode(e.target.dataset.mode);
                    });
                });

                this.dom.toSettingsBtn.addEventListener('click', () => { this.openSettings(); this.physics.rotateY.impulse(10); });
                this.dom.saveBtn.addEventListener('click', () => this.saveSettings());
                this.dom.cancelBtn.addEventListener('click', () => this.closeSettings());
                
                this.dom.langBtns.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.lang = e.target.dataset.lang;
                        this.dom.langBtns.forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.updateText();
                    });
                });
                
                this.dom.focusInput.addEventListener('input', (e) => this.dom.focusVal.textContent = e.target.value);
                this.dom.breakInput.addEventListener('input', (e) => this.dom.breakVal.textContent = e.target.value);
                
                this.initResize();
            }

            initResize() {
                this.isResizing = false;
                let startX, startAppScale;
                this.dom.resizeHandle.addEventListener('mousedown', (e) => {
                    this.isResizing = true; startX = e.clientX; startAppScale = this.state.appScale;
                    this.dom.resizeHandle.style.cursor = 'grabbing'; e.preventDefault();
                });
                document.addEventListener('mousemove', (e) => {
                    if (!this.isResizing) return;
                    const deltaX = e.clientX - startX;
                    let newScale = Math.max(0.6, Math.min(2.5, startAppScale + deltaX * 0.003));
                    this.state.appScale = newScale;
                    document.documentElement.style.setProperty('--app-scale', newScale);
                    this.physics.scale.target = 1.0 + Math.sin(deltaX * 0.1) * 0.02; 
                });
                document.addEventListener('mouseup', () => {
                    if (this.isResizing) {
                        this.isResizing = false; this.dom.resizeHandle.style.cursor = 'nwse-resize'; this.physics.scale.target = 1.0;
                    }
                });
            }

            updateDisplay() {
                const total = Math.max(0, this.state.timeLeft);
                const m = Math.floor(total / 60).toString().padStart(2, '0');
                const s = (total % 60).toString().padStart(2, '0');
                const timeString = `${m}:${s}`;
                this.dom.display.textContent = timeString;
                const status = this.state.mode === 'focus' ? 'Focus' : 'Break';
                document.title = this.state.isRunning ? `(${timeString}) ${status} - Pomodoro` : `Pomodoro ${status}`;
                const pct = (this.state.timeLeft / this.state.initialTime) * 100;
                this.dom.ring.style.strokeDashoffset = Math.max(0, 100 - pct);
            }

            toggleTimer() {
                if (this.state.isRunning) this.pause();
                else this.start();
            }

            start() {
                if (this.state.isRunning) return;
                this.state.isRunning = true;
                this.dom.scene.classList.remove('alarm-active');
                this.updateText();
                this.state.timerId = setInterval(() => {
                    if (this.state.timeLeft > 0) {
                        this.state.timeLeft--;
                        this.updateDisplay();
                    } else {
                        this.complete();
                    }
                }, 1000);
            }

            pause() {
                this.state.isRunning = false;
                clearInterval(this.state.timerId);
                this.updateText();
            }

            reset() {
                this.pause();
                const base = this.state.mode === 'focus' ? this.settings.focus : this.settings.break;
                this.state.initialTime = base * 60;
                this.state.timeLeft = this.state.initialTime;
                this.dom.ring.style.transition = 'stroke-dashoffset 0.5s ease-out';
                this.dom.scene.classList.remove('alarm-active');
                this.updateDisplay();
                setTimeout(() => this.dom.ring.style.transition = 'stroke-dashoffset 1s linear', 500);
            }

            subtractTime() {
                if (this.state.timeLeft <= 0) return;
                this.state.timeLeft = Math.max(0, this.state.timeLeft - 5);
                this.updateDisplay();
                this.dom.minusHint.classList.remove('minus-five-anim');
                void this.dom.minusHint.offsetWidth; 
                this.dom.minusHint.classList.add('minus-five-anim');
                this.dom.scene.classList.remove('squash-anim');
                void this.dom.scene.offsetWidth;
                this.dom.scene.classList.add('squash-anim');
            }

            complete() {
                this.pause();
                this.state.timeLeft = 0;
                this.updateDisplay();
                
                // 視覺特效
                this.dom.scene.classList.add('alarm-active');
                this.spawnParticles();

                // 自動跳轉邏輯
                setTimeout(() => {
                    const nextMode = this.state.mode === 'focus' ? 'break' : 'focus';
                    this.switchMode(nextMode);
                }, 1500); // 1.5秒後自動切換狀態
            }

            // 新增：切換模式邏輯
            switchMode(newMode) {
                this.state.mode = newMode;
                document.body.classList.toggle('break-mode', newMode === 'break');
                
                // 更新按鈕狀態
                this.dom.modeBtns.forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.mode === newMode);
                });

                this.reset();
            }

            spawnParticles() {
                const rect = this.dom.timerArea.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                for (let i = 0; i < 40; i++) {
                    const p = document.createElement('div');
                    p.classList.add('particle');
                    document.body.appendChild(p);
                    const angle = Math.random() * Math.PI * 2;
                    const velocity = (Math.random() * 10 + 5) * this.state.appScale; 
                    const tx = Math.cos(angle) * velocity * 15;
                    const ty = Math.sin(angle) * velocity * 15;
                    p.style.left = centerX + 'px';
                    p.style.top = centerY + 'px';
                    p.style.width = (0.5 * this.state.appScale) + 'em';
                    p.style.height = (0.5 * this.state.appScale) + 'em';
                    p.style.transition = `all 0.8s cubic-bezier(0.165, 0.84, 0.44, 1)`;
                    requestAnimationFrame(() => {
                        p.style.transform = `translate(${tx}px, ${ty}px) scale(0)`;
                        p.style.opacity = 0;
                    });
                    setTimeout(() => p.remove(), 800);
                }
            }

            openSettings() {
                this.dom.focusInput.value = this.settings.focus;
                this.dom.breakInput.value = this.settings.break;
                this.dom.focusVal.textContent = this.settings.focus;
                this.dom.breakVal.textContent = this.settings.break;
                this.dom.cardWrapper.classList.add('is-flipped');
            }
            closeSettings() { this.dom.cardWrapper.classList.remove('is-flipped'); }
            saveSettings() {
                this.settings.focus = parseInt(this.dom.focusInput.value);
                this.settings.break = parseInt(this.dom.breakInput.value);
                if (!this.state.isRunning) this.reset();
                this.closeSettings();
            }
            updateText() {
                const t = TRANSLATIONS[this.lang];
                this.dom.i18nElements.forEach(el => {
                    const key = el.dataset.i18n;
                    if (key && t[key]) {
                        if (key === 'start') {
                            el.textContent = this.state.isRunning ? t.pause : (this.state.timeLeft < this.state.initialTime && this.state.timeLeft > 0 ? t.resume : t.start);
                        } else {
                            el.textContent = t[key];
                        }
                    }
                });
            }
        }

        const app = new PomodoroApp();
    </script>
</body>
</html>